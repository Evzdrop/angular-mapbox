!function(){"use strict";angular.module("angular-mapbox",[])}(),function(){"use strict";angular.module("angular-mapbox").service("mapboxService",["utils",function(e){function a(e){e=e||{},L.mapbox.accessToken=e.accessToken}function r(e,a,r){a=a||{},d.push(e),p.push(a),f.push(r||[]),m[o(e)]=e}function o(e){return e._container.id}function n(e){var a=d.indexOf(e);delete m[o(e)],a>=0&&(d.splice(a,1),p.splice(a,1),f.splice(a,1))}function t(){return d}function i(e){return m[e]}function l(e){var a=d.indexOf(e);return f[a]}function c(e){var a=d.indexOf(e);return p[a]}function u(e,a){var r=d.indexOf(e),o=f[r],n=p[r];o.push(a),n.scaleToFit&&g(e)}function s(e,a){e.removeLayer(a);var r,o=l(e);if(o){for(var o,n=0;o[n];n++)o[n]._leaflet_id===a._leaflet_id&&(r=n);o.splice(r,1);var t=c(e);t.scaleToFit&&t.scaleToFitAll&&g(e)}}var d=[],f=[],m={},p=[],g=e.debounce(function(e){var a=new L.featureGroup(l(e));e.fitBounds(a.getBounds())},0);return{init:a,getMapInstances:t,addMapInstance:r,removeMapInstance:n,getMarkersForMap:l,addMarker:u,removeMarker:s,fitMapToMarkers:g,getOptionsForMap:c,getMapInstance:i}}])}(),function(){"use strict";angular.module("angular-mapbox").constant("utils",{debounce:function(e,a,r){var o;return function(){var n=this,t=arguments,i=function(){o=null,r||e.apply(n,t)},l=r&&!o;clearTimeout(o),o=setTimeout(i,a),l&&e.apply(n,t)}}})}(),function(){"use strict";angular.module("angular-mapbox").directive("featureLayer",function(){return{restrict:"E",require:"^mapbox",link:function(e,a,r,o){var n;o.getMap().then(function(t){if(r.data){var i=e.$eval(r.data);n=L.mapbox.featureLayer(i)}else r.url&&(n=L.mapbox.featureLayer(r.url));n&&(n.addTo(t),o.addFeatureLayer(n),a.bind("$destroy",function(){t.removeLayer(n),o.removeFeatureLayer(n)}))})}}})}(),function(){"use strict";angular.module("angular-mapbox").directive("htmlMarker",function(e,a,r){function o(e,a,o,i,l){var c,u,s;u={draggable:void 0!==o.draggable,className:o.className,html:o.html,width:o.width,height:o.height},s=n(o),i.getMap().then(function(i){l(e,function(a){var r;if(null!==a&&a.length>0){r=document.createElement("span");for(var l=0;l<a.length;l++)r.appendChild(a[l])}void 0!==o.currentLocation?(s=n(s,{"marker-color":"#000","marker-symbol":"star"}),u.excludeFromClustering=!0,i.on("locationfound",function(a){c=t(e,i,[a.latlng.lat,a.latlng.lng],r,u,s)}),i.locate()):c=t(e,i,[o.lat,o.lng],r,u,s)});var d=function(){c.setLatLng([o.lat,o.lng])};o.$observe("lat",d),o.$observe("lng",d),a.bind("$destroy",function(){r.getOptionsForMap(i).clusterMarkers?e.clusterGroup.removeLayer(c):r.removeMarker(i,c)})})}function n(e,a){var r=a||{};return e.size&&(r["marker-size"]=e.size),e.color&&("#"===e.color[0]?r["marker-color"]=e.color:r["marker-color"]=i[e.color]||e.color),e.icon&&(r["marker-symbol"]=e.icon),r}function t(e,a,o,n,t){t=t||{};var i=L.marker(o,{icon:L.divIcon({className:t.className,html:t.html,iconSize:t.width&&t.height?[t.width,t.height]:null})});return n&&i.bindPopup(n),r.getOptionsForMap(a).clusterMarkers&&t.excludeFromClustering!==!0?e.clusterGroup.addLayer(i):i.addTo(a),t.draggable&&i.dragging.enable(),r.addMarker(a,i),i}var i={navy:"#001f3f",blue:"#0074d9",aqua:"#7fdbff",teal:"#39cccc",olive:"#3d9970",green:"#2ecc40",lime:"#01ff70",yellow:"#ffdc00",orange:"#ff851b",red:"#ff4136",fuchsia:"#f012be",purple:"#b10dc9",maroon:"#85144b",white:"white",silver:"#dddddd",gray:"#aaaaaa",black:"#111111"};return{restrict:"E",require:"^mapbox",transclude:!0,scope:!0,link:o}})}(),function(){"use strict";angular.module("angular-mapbox").directive("mapbox",["$q","$parse","$timeout","mapboxService",function(e,a,r,o){var n;return{restrict:"E",transclude:!0,scope:{onReposition:"&?",onZoom:"&?",onClick:"&?"},replace:!0,template:'<div class="angular-mapbox-map" ng-transclude></div>',controller:function(a){n=e.defer(),this.getMap=function(){return n.promise},this.addFeatureLayer=function(e){a.featureLayers.push(e)},this.removeFeatureLayer=function(e){a.featureLayers.slice(a.featureLayers.indexOf(e),1)},this.$scope=a},link:function(e,a,t){var i=a[0];i.id=t.id,e.map=L.mapbox.map(i,t.mapId),e.markers=[],e.featureLayers=[];var l={clusterMarkers:void 0!==t.clusterMarkers,scaleToFit:void 0!==t.scaleToFit,scaleToFitAll:"all"===t.scaleToFit};if(void 0!==l.clusterMarkers&&(l.clusterGroup=new L.MarkerClusterGroup,e.map.addLayer(l.clusterGroup)),o.addMapInstance(e.map,l,e.markers),n.resolve(e.map),"false"===t.dragging&&e.map.dragging.disable(),"false"===t.touchZoom&&e.map.touchZoom.disable(),"false"===t.doubleClickZoom&&e.map.doubleClickZoom.disable(),"false"===t.scrollWheelZoom&&e.map.scrollWheelZoom.disable(),void 0===t.autoSize){var c=t.width||"100",u=t.height||500;isNaN(c)?a.css("width",c):a.css("width",c+"%"),isNaN(u)?a.css("height",u):a.css("height",u+"px")}e.onReposition&&e.map.on("dragend",function(a){r(function(){e.onReposition({event:a,map:e.map})})}),e.onZoom&&e.map.on("zoomend",function(a){r(function(){e.onZoom({event:a,map:e.map})})}),e.onClick&&e.map.on("click",function(a){r(function(){e.onClick({event:a,map:e.map})})});var s=function(){var a=t.zoom||12;t.lat&&t.lng?e.map.setView([t.lat,t.lng],a):e.map.setZoom(a)};t.$observe("lat",s),t.$observe("lng",s),t.$observe("zoom",s),a.bind("$destroy",function(){o.removeMapInstance(e.map)}),s()}}}])}(),function(){"use strict";angular.module("angular-mapbox").directive("marker",function(e,a,r,o){function n(e,a,n,l,c){var u,s,d;s={draggable:void 0!==n.draggable},d=t(n);var f=o.getMapInstance(n.id);c(e,function(a){var o;if(null!==a&&a.length>0){o=document.createElement("span");for(var l=0;l<a.length;l++)o.appendChild(a[l])}if(void 0!==n.currentLocation)d=t(d,{"marker-color":"#000","marker-symbol":"star"}),s.excludeFromClustering=!0,f.on("locationfound",function(a){u=i(e,f,[a.latlng.lat,a.latlng.lng],o,s,d)}),f.locate();else if(u=i(e,f,[n.lat,n.lng],o,s,d),n.onClick){var c=r(n.onClick,null,!0);u.on("click",function(){e.$apply(function(){c(e,{$event:event})})})}}),a.bind("$destroy",function(){o.getOptionsForMap(f)&&o.getOptionsForMap(f).clusterMarkers?o.getOptionsForMap(f).clusterGroup.removeLayer(u):o.removeMarker(f,u)})}function t(e,a){var r=a||{};return e.size&&(r["marker-size"]=e.size),e.color&&("#"===e.color[0]?r["marker-color"]=e.color:r["marker-color"]=l[e.color]||e.color),e.icon&&(r["marker-symbol"]=e.icon),r}function i(e,a,r,n,t,i){t=t||{};var l=L.marker(r,t);return n&&l.bindPopup(n),o.getOptionsForMap(a).clusterMarkers&&t.excludeFromClustering!==!0?o.getOptionsForMap(a).clusterGroup.addLayer(l):l.addTo(a),t.draggable&&l.dragging.enable(),o.addMarker(a,l),l}var l={navy:"#001f3f",blue:"#0074d9",aqua:"#7fdbff",teal:"#39cccc",olive:"#3d9970",green:"#2ecc40",lime:"#01ff70",yellow:"#ffdc00",orange:"#ff851b",red:"#ff4136",fuchsia:"#f012be",purple:"#b10dc9",maroon:"#85144b",white:"white",silver:"#dddddd",gray:"#aaaaaa",black:"#111111"};return{restrict:"E",require:"^mapbox",transclude:!0,scope:!0,link:n}})}();